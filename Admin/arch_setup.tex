\documentclass[a4paper, 12pt]{article}
\usepackage{textmpl_base}

\title{How-to install \url{Arch Linux}}
\author{Alexey Minchakov}
\date{\today}

\begin{document}
\maketitle

\section{Prepare flash drive}

Download linux.iso.
\begin{lstlisting}
$> lsblk
$> sudo gparted # format flash Fat32
$> sudo dd bs=16M if=linux.iso of=/dev/sdc status=progress oflag=sync
\end{lstlisting}

\section{BIOS}

Security \textrightarrow{} Secure Boot \textrightarrow{} Disable
\\Also were disabled WWAN, Thunderbolt 3, Card Reader.

\section{Installation}

Setup internet connection:
\begin{lstlisting}
$> ping google.com
$> wifi-menu
\end{lstlisting}

Update \path{/etc/pacman.d/mirrorlist}, retrieve most up-to-date mirrors:
\begin{lstlisting}
$> pacman -Syy
$> pacman -S reflector
$> reflector -c "Russia" -f 12 -l 10 -n 12 --save /etc/pacman.d/mirrorlist
\end{lstlisting}

Disk partition utils: \url{cfdisk}, \url{gdisk}.
Add partition \url{UEFI} - minimum 550MB at the beginning of disk, file system type should be \url{EFI boot partition}. Format it \url{Fat32}.
\\Partition table for Linux:
\begin{itemize}
\item \path{/boot} 500MB, ext2
\item \path{swap} RAM size
\item \path{/} minimum 30GB ext4 (depend on existing \path{/var} partition)
\item \path{/var} 8GB ext4
\item \path{/home} ext4
\end{itemize}

Check and prepare disk drive.
\begin{lstlisting}
$> fdisk -l # list disk partitions
$> cfdisk /dev/sdv # setup partitions
$> gdisk # setup partitions
$> mkfs.ext2 /dev/partition -L boot
$> mkfs.ext4 /dev/partition -L root
$> mkswap /dev/partition -L swap
$> pacman -S dosfstools vim
$> mkfs.fat -F32 /dev/partition
\end{lstlisting}

Mounting drives:
\begin{lstlisting}
$> lsblk # list block devices and mount points
$> mkdir /mnt/{boot,var,home}
$> mkdir /mnt/boot/efi
$> mount /dev/sdb1 /mnt/...
$> swapon /dev/sdb5
\end{lstlisting}

Begin installation:
\begin{lstlisting}
$> pacstrap -i /mnt base base-devel # install group of packages
$> genfstab -U -p /mnt >> /mnt/etc/fstab # generate /etc/fstab file
$> arch-chroot /mnt /bin/bash # change root dir
$> vim /etc/locale.gen    # uncomment lines en_US.UTF-8, ru_RU.UTF-8
$> locale-gen # generate locale files
# select timezone
$> ln -sf /usr/share/zoneinfo/Europe/Moscow /etc/localtime
# set hardware clock from system clock and update /etc/adjtime
$> hwclock --systohc [--utc]
$> echo MyHostName > /etc/hostname
$> vim /etc/hosts
\end{lstlisting}

\begin{lstlisting}[style=style_file,caption={\path{/etc/hosts} add lines:}]
127.0.0.1    localhost.localdomain    localhost
::1          localhost.localdomain    localhost
127.0.0.1    localhost.localdomain    MyHostName
\end{lstlisting}

\begin{lstlisting}
$> systemctl enable dhcpcd
$> passwd     # setup root passwd
$> pacman -S grub [os-prober]
\end{lstlisting}

If legacy BIOS:
\begin{lstlisting}
$> grub-install --target=i386-pc --recheck /dev/partition
\end{lstlisting}

If UEFI:
\begin{lstlisting}
$> pacman -S efibootmgr
$> grub-install --targer=x86_64-efi --efi-directory=/boot/efi --bootloader-id=GRUB
\end{lstlisting}

Continue installation:
\begin{lstlisting}
$> grub-mkconfig -o /boot/grub/grub.cfg
$> exit
$> umount -R /mnt
$> shutdown now
\end{lstlisting}

After reboot remove USB flash drive, login as root, add and configure new user:
\begin{lstlisting}
$> useradd -m -g users -G wheel -s /bin/bash UserName
$> passwd UserName
$> EDITOR=vim visudo
\end{lstlisting}

\begin{lstlisting}[style=style_file,caption={\path{sudoers} uncomment:}]
%wheel=ALL (ALL) ALL
\end{lstlisting}

\begin{lstlisting}
$> exit
\end{lstlisting}

Login as UserName:
\begin{lstlisting}
$> sudo pacman -S pulseaudio pulseaudio-alsa xorg xorg-xinit i3-gaps rxvt-unicode i3blocks dialog wpa_supplicant lua feh rofi playerctl gvfs mpg123 ntfs-3g
\end{lstlisting}

If WiFi doesn't work (\url{netctl} may conflict with \url{networkmanager}):
\begin{lstlisting}
$> ls /sys/class/net # all network interfaces
$> sudo netctl status wl..
# $> sudo systemctl stop dhcpcd.service
# $> sudo systemctl disable dhcpcd.service
$> sudo rm -rf /var/lib/dhcpcd/*.lease
$> sudo rm /etc/systemd/system/multi-user.target.wants/netctl*
$> sudo rm /etc/netctl/wl..
$> reboot
$> wifi-menu # or cp Admin/etc/netctl/wifi /etc/netctl/wl..
$> sudo netctl start wl..
$> sudo netctl enable wl..
\end{lstlisting}

\section{dotfiles}

To get all stuff:
\begin{lstlisting}
$> git init .
$> git remote add -t \* -f origin https://github.com/lexaaim/dotfiles.git
$> git checkout master # get all branches and co master
\end{lstlisting}

Setup \url{Oh My ZSH!}:
\begin{lstlisting}
$> mv .oh_my_zsh bkp # backup
$> sh -c "$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)"
$> mv bkp/themes/... .oh-my-zsh/themes/
$> rm -rf bkp
$> git checkout -- .zshrc
\end{lstlisting}

Setup \url{Vim}:
\begin{lstlisting}
$> curl -fLo ~/.vim/autoload/plug.vim --create-dirs  https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
vim> :PlugInstall
\end{lstlisting}

Change default shell (for \url{X} autostart from \path{$HOME/.zprofile} script):
\begin{lstlisting}
$> chsh
\end{lstlisting}

Setup fonts, icons:
\begin{lstlisting}
$> cd Temp/AUR
# font: Dejavu Sans Mono Powerline
$> git clone https://aur.archlinux.org/ttf-dejavu-sans-mono-powerline-git.git
# icons: Arc
$> pacman -S arc-gtk-theme arc-icon-theme lxappearance
\end{lstlisting}

Mount tmpfs:
\begin{lstlisting}
$> df -h
# example /etc/fstab tmpfs 1000M ~/.cache:
$> sudo vim /etc/fstab
\end{lstlisting}

\begin{lstlisting}[style=style_file,caption={\path{/etc/fstab} add line:}]
tmpfs  /home/user/.cache  tmpfs  defaults,nodev,nosuid,mode=1777,size=1G  0 0
\end{lstlisting}

Setup SSD Trim attributes in \path{/etc/fstab}:
\begin{itemize}
\item ''\url{discard}'' to \url{ext4}, \url{swap} fs
\item ''\url{noatime}'' to \url{ext2}, \url{ext4} fs
\end{itemize}

Setup backlight:
\begin{lstlisting}
$> sudo pacman -S xorg-xbacklight xf86-video-intel
\end{lstlisting}

Other packages:
\begin{lstlisting}
$> sudo pacman -S scrot # take screenshots
\end{lstlisting}

Disabling TrackPoint:
\begin{lstlisting}
$> xinput # show input devices
$> xinput --disable "Device Name"
\end{lstlisting}

\end{document}
